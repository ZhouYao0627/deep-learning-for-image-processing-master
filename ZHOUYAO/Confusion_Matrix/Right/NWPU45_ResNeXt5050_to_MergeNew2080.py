import numpy as np
import matplotlib.pyplot as plt
import itertools
import seaborn as sns

np.set_printoptions(threshold=np.inf)


# 绘制混淆矩阵
def plot_confusion_matrix(cm, classes, normalize=False, title='Confusion matrix', cmap=plt.cm.Blues):
    """
    This function prints and plots the confusion matrix.
    Normalization can be applied by setting `normalize=True`.
    Input
    - cm : 计算出的混淆矩阵的值
    - classes : 混淆矩阵中每一行每一列对应的列
    - normalize : True:显示百分比, False:显示个数
    """
    if normalize:
        cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
        print("Normalized confusion matrix")
    else:
        print('Confusion matrix, without normalization')
    print(cm)

    plt.imshow(cm, interpolation='nearest', cmap=cmap)
    plt.title(title)
    plt.colorbar()
    tick_marks = np.arange(len(classes))
    plt.xticks(tick_marks, classes, rotation=90, fontsize=4)
    plt.yticks(tick_marks, classes, fontsize=4)

    sns.set(font_scale=0.2)  # 调整混淆矩阵中字体的大小
    fmt = '.2f' if normalize else 'd'
    thresh = cm.max() / 2.
    for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])):
        plt.text(j, i, format(cm[i, j], fmt),
                 verticalalignment='center',
                 horizontalalignment='center',
                 color="white" if cm[i, j] > thresh else "black")
    plt.gcf().subplots_adjust(bottom=0.3)
    plt.tight_layout()
    plt.xlabel('Predicted label')
    plt.ylabel('True label')
    plt.savefig("../plot/NWPU_resnext_5050_to_mergenew_2080_Fig1.png", dpi=500, format="png", bbox_inches='tight')
    plt.show()


cnf_matrix = np.array([[0.97707736, 0.0286533, 0., 0.00286533, 0., 0.,
                        0., 0., 0.00286533, 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00286533, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.01146132, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0.00554017, 0.92797784, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.00554017, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0.00277008, 0., 0.,
                        0., 0., 0., 0.00277008, 0., 0.,
                        0., 0., 0., 0., 0.04709141, 0.,
                        0.00277008, 0., 0., 0., 0., 0.,
                        0.00554017, 0., 0.],
                       [0., 0., 0.98538012, 0., 0., 0.00292398,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.00292398, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00292398, 0., 0., 0.00584795, 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0.00287356, 0.97126437, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.00574713, 0.00287356, 0., 0., 0.,
                        0., 0.00287356, 0., 0., 0.00287356, 0.00287356,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00287356, 0., 0., 0., 0., 0.00287356,
                        0., 0., 0.00287356],
                       [0., 0.00275482, 0., 0., 0.95041322, 0.00275482,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.00275482,
                        0., 0., 0.01652893, 0.00550964, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00550964, 0., 0., 0.00275482,
                        0.00275482, 0.00550964, 0., 0., 0., 0.,
                        0., 0., 0.00275482],
                       [0., 0.00588235, 0., 0., 0.00294118, 0.94117647,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00882353, 0., 0., 0.,
                        0., 0., 0., 0.00294118, 0., 0.,
                        0., 0., 0.00294118, 0., 0., 0.00294118,
                        0., 0., 0.00588235, 0., 0., 0.,
                        0.02352941, 0., 0., 0.00294118, 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0.99428571, 0., 0., 0., 0., 0.,
                        0., 0.00285714, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.00285714, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0.83550914, 0., 0., 0.03133159, 0.,
                        0., 0., 0.00261097, 0., 0., 0.,
                        0., 0.00522193, 0., 0., 0., 0.,
                        0., 0., 0., 0.10966057, 0., 0.,
                        0.00261097, 0., 0., 0.00522193, 0., 0.,
                        0., 0., 0.00522193, 0., 0.00261097, 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.00274725,
                        0., 0., 0.9532967, 0., 0., 0.,
                        0.00274725, 0., 0., 0., 0., 0.,
                        0., 0., 0.00274725, 0.00274725, 0., 0.,
                        0., 0.00274725, 0., 0.00274725, 0., 0.,
                        0., 0.02747253, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00274725, 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0.966759, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00277008, 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00277008, 0., 0.00554017, 0.,
                        0., 0.01385042, 0., 0., 0., 0.,
                        0., 0.00831025, 0.],
                       [0., 0.00286533, 0.00286533, 0., 0., 0.,
                        0., 0.01432665, 0., 0., 0.91977077, 0.00286533,
                        0., 0., 0., 0., 0.00286533, 0.00286533,
                        0.00286533, 0.00286533, 0.00286533, 0., 0., 0.,
                        0., 0., 0., 0.01719198, 0.00286533, 0.,
                        0.00286533, 0., 0.00286533, 0., 0., 0.,
                        0.01146132, 0., 0., 0., 0., 0.,
                        0., 0.00286533, 0.00286533],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.00623053, 0.92834891,
                        0., 0., 0., 0., 0., 0.,
                        0.00934579, 0.00311526, 0., 0., 0., 0.02492212,
                        0.01557632, 0., 0., 0.00934579, 0., 0.,
                        0., 0., 0., 0.00311526, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0.00285714, 0.,
                        0.00285714, 0., 0., 0.00285714, 0., 0.,
                        0.96285714, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.02571429, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.00285714, 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.96306818, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.01420455, 0.,
                        0., 0.00284091, 0., 0., 0., 0.,
                        0., 0.00284091, 0.00568182, 0., 0., 0.,
                        0., 0., 0.00568182, 0., 0., 0.,
                        0., 0., 0.00568182],
                       [0., 0., 0., 0.00299401, 0., 0.00598802,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.95808383, 0., 0., 0.,
                        0., 0.00898204, 0., 0., 0.00898204, 0.,
                        0., 0., 0.00898204, 0., 0., 0.00299401,
                        0.00299401, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0.99140401, 0., 0.,
                        0., 0., 0., 0., 0.00573066, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00286533, 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0.00576369, 0., 0., 0.,
                        0., 0., 0., 0., 0.00288184, 0.,
                        0., 0., 0.00288184, 0., 0.95677233, 0.,
                        0., 0.00288184, 0., 0., 0.00288184, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00576369, 0., 0., 0.,
                        0., 0., 0., 0.02017291, 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.9719888,
                        0.00560224, 0., 0., 0., 0., 0.,
                        0.00840336, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.01120448, 0., 0., 0.00280112, 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0.00297619, 0., 0.,
                        0., 0.00595238, 0., 0., 0.00595238, 0.00297619,
                        0., 0., 0., 0., 0., 0.,
                        0.95535714, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0.00595238, 0.00297619, 0.00297619,
                        0.00297619, 0., 0., 0., 0., 0.,
                        0.00297619, 0., 0., 0., 0., 0.,
                        0., 0.00892857, 0.],
                       [0., 0., 0., 0., 0., 0.00295858,
                        0., 0.00887574, 0., 0., 0.00887574, 0.00295858,
                        0., 0., 0.00591716, 0., 0., 0.,
                        0., 0.9556213, 0., 0., 0., 0.,
                        0., 0., 0., 0.00295858, 0.00295858, 0.00295858,
                        0., 0., 0., 0.00591716, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0.00882353, 0.00294118,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.97058824, 0.00588235, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00588235, 0., 0., 0.00294118,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00294118],
                       [0., 0., 0., 0., 0., 0.00328947,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0.97368421, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.00328947, 0.,
                        0., 0.00328947, 0., 0., 0., 0.,
                        0., 0., 0.01644737],
                       [0., 0.00299401, 0., 0., 0., 0.00299401,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.00299401, 0.00299401, 0., 0., 0.,
                        0., 0., 0., 0., 0.96407186, 0.,
                        0., 0.00898204, 0., 0., 0., 0.,
                        0., 0.00299401, 0.00299401, 0., 0., 0.,
                        0.00299401, 0., 0., 0., 0., 0.,
                        0.00299401, 0., 0.00299401],
                       [0., 0., 0.00512821, 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.07948718,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.02307692, 0., 0., 0., 0.85128205,
                        0.01794872, 0., 0., 0.0025641, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.01538462, 0., 0., 0.00512821,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.04057971,
                        0., 0., 0., 0., 0., 0.,
                        0.00289855, 0.0057971, 0., 0., 0., 0.0057971,
                        0.94202899, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00289855, 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.02631579, 0.00584795, 0., 0.00292398, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.94736842, 0., 0., 0., 0.,
                        0., 0.00292398, 0.00292398, 0., 0., 0.00584795,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00584795],
                       [0., 0., 0., 0., 0., 0.03183024,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.0265252, 0., 0.00265252, 0.,
                        0., 0.00265252, 0., 0., 0., 0.,
                        0., 0., 0.90450928, 0.00265252, 0., 0.00265252,
                        0.00530504, 0., 0., 0.02122016, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0.003125, 0.003125, 0.003125, 0., 0., 0.,
                        0., 0.046875, 0., 0., 0.009375, 0.003125,
                        0., 0., 0., 0., 0.003125, 0.,
                        0.0125, 0., 0., 0., 0., 0.,
                        0.003125, 0., 0., 0.871875, 0.003125, 0.,
                        0., 0., 0.00625, 0.00625, 0., 0.,
                        0.003125, 0., 0., 0.00625, 0.009375, 0.,
                        0., 0.00625, 0.],
                       [0., 0., 0.00550964, 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.00275482,
                        0., 0., 0.00550964, 0., 0., 0.00275482,
                        0., 0.00826446, 0., 0., 0.00275482, 0.,
                        0.00826446, 0., 0.00275482, 0.00550964, 0.95041322, 0.00275482,
                        0.00275482, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.00286533,
                        0.00286533, 0.00286533, 0., 0., 0., 0.,
                        0., 0., 0.00859599, 0., 0., 0.,
                        0.00573066, 0.00286533, 0., 0., 0., 0.,
                        0., 0., 0.00286533, 0., 0., 0.93982808,
                        0.02578797, 0., 0., 0., 0.00286533, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.00286533, 0.],
                       [0., 0.00549451, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.00549451, 0.,
                        0., 0., 0., 0., 0.00274725, 0.,
                        0.02197802, 0., 0., 0., 0., 0.,
                        0., 0., 0.00824176, 0.00274725, 0., 0.04395604,
                        0.8956044, 0.00274725, 0., 0.00549451, 0.00549451, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0.0031348, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.0031348, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.96865204, 0.00626959, 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.0031348,
                        0.01567398, 0., 0.],
                       [0., 0., 0., 0., 0., 0.00835655,
                        0., 0., 0.00278552, 0., 0.00278552, 0.,
                        0., 0., 0., 0.00278552, 0., 0.,
                        0., 0., 0.01671309, 0.02506964, 0., 0.,
                        0., 0.00278552, 0., 0., 0., 0.,
                        0., 0.00278552, 0.91922006, 0., 0., 0.,
                        0., 0., 0.00278552, 0.00557103, 0., 0.,
                        0.00278552, 0., 0.00557103],
                       [0.00294118, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.00294118,
                        0., 0., 0., 0., 0., 0.,
                        0.00294118, 0., 0., 0., 0., 0.,
                        0.00294118, 0., 0., 0., 0., 0.,
                        0.00294118, 0., 0., 0.97941176, 0., 0.,
                        0., 0., 0., 0.00294118, 0.00294118, 0.,
                        0., 0., 0.],
                       [0.01169591, 0.00877193, 0., 0., 0., 0.,
                        0., 0.00292398, 0., 0., 0., 0.,
                        0., 0., 0.01169591, 0., 0., 0.,
                        0., 0.00292398, 0., 0., 0., 0.,
                        0., 0., 0., 0.00292398, 0.00292398, 0.,
                        0.00877193, 0., 0., 0., 0.94444444, 0.,
                        0.00292398, 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 1.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.],
                       [0.00304878, 0., 0., 0., 0., 0.00914634,
                        0., 0.00304878, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00304878, 0., 0.00304878, 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.00304878,
                        0.97256098, 0., 0., 0., 0., 0.,
                        0., 0.00304878, 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0.00864553, 0., 0.,
                        0., 0.00576369, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0.98270893, 0., 0., 0., 0.,
                        0., 0.00288184, 0.],
                       [0., 0., 0.00280899, 0., 0., 0.,
                        0., 0.00280899, 0., 0., 0., 0.,
                        0.00280899, 0.01123596, 0., 0.00280899, 0., 0.,
                        0., 0.00280899, 0., 0., 0.01123596, 0.01123596,
                        0.00280899, 0., 0., 0.00280899, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00561798, 0., 0.93539326, 0., 0., 0.00561798,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.03508772, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00292398, 0., 0., 0.00292398, 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.00584795, 0., 0., 0.95321637, 0., 0.,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.002849, 0., 0., 0., 0.002849, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.002849, 0., 0., 0., 0., 0.,
                        0.00569801, 0., 0., 0.002849, 0.98005698, 0.,
                        0., 0.002849, 0.],
                       [0., 0., 0.00793651, 0.02380952, 0., 0.,
                        0., 0.0026455, 0., 0., 0., 0.0026455,
                        0., 0., 0.00529101, 0.0026455, 0.00529101, 0.,
                        0.00529101, 0., 0., 0., 0.0026455, 0.00529101,
                        0.00793651, 0., 0., 0.0026455, 0., 0.,
                        0., 0.0026455, 0., 0., 0., 0.,
                        0., 0., 0.00793651, 0.0026455, 0.0026455, 0.91005291,
                        0., 0., 0.],
                       [0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.00263852, 0., 0., 0.00263852,
                        0., 0.02110818, 0., 0.00527704, 0., 0.,
                        0., 0.06332454, 0.00527704, 0., 0., 0.,
                        0., 0., 0.00263852, 0., 0., 0.,
                        0.89709763, 0., 0.],
                       [0., 0.0056338, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0.0028169, 0.,
                        0., 0., 0., 0., 0., 0.,
                        0.0056338, 0., 0., 0., 0., 0.,
                        0., 0., 0., 0.0084507, 0., 0.,
                        0.0084507, 0., 0., 0., 0., 0.,
                        0.0028169, 0., 0., 0.01690141, 0., 0.,
                        0., 0.94929577, 0.],
                       [0., 0., 0., 0., 0., 0.00516796,
                        0., 0., 0.00258398, 0., 0., 0.,
                        0.00516796, 0., 0., 0., 0., 0.,
                        0., 0., 0.00775194, 0.09043928, 0.01808786, 0.,
                        0., 0.00258398, 0., 0.00258398, 0., 0.,
                        0., 0.00258398, 0., 0., 0., 0.,
                        0., 0., 0., 0., 0., 0.,
                        0., 0., 0.8630491]])
print(cnf_matrix.shape)
attack_types = ['airplane', 'airport', 'baseball_diamond', 'basketball_court', 'beach', 'bridge', 'chaparral', 'church',
                'circular_farmland', 'cloud', 'commercial_area', 'dense_residential', 'desert', 'forest', 'freeway',
                'golf_course', 'ground_track_field', 'harbor', 'industrial_area', 'intersection', 'island',
                'lake', 'meadow', 'medium_residential', 'mobile_home_park', 'mountain', 'overpass', 'palace',
                'parking_lot', 'railway', "railway_station", "rectangular_farmland", "river", "roundabout", "runway",
                "sea_ice", "ship", "snowberg", "sparse_residential", "stadium", "storage_tank", "tennis_court",
                "terrace", "thermal_power_station", "wetland"]

plot_confusion_matrix(cnf_matrix, classes=attack_types, normalize=True, title='Confusion Matrix')
